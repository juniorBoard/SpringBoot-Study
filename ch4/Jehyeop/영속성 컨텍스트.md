# 영속성 컨텍스트(Persistence Context)
- **엔티티를 영구히 저장하는 환경**
- **애플리케이션과 데이터베이스 사이**에서 엔티티와 레코드의 괴리를 해소하는 기능과 **객체를 보관하는 기능**을 수행
- **엔티티 객체**가 영속성 컨텍스트에 들어오면 JPA 는 엔티티 객체의 매핑 정보를 데이터베이스에 반영하는 작업을 수행
- **엔티티 객체**가 영속성 컨텍스트에 들어와 JPA 의 관리 대상이 되는 시점부터는 해당 객체를 영속 객체(Persistence Object)라고 부른다.
- **세션단위의 생명주기**를 가진다.  
  → 데이터베이스에 접근하기 위한 세션이 생성되면 영속성 컨텍스트가 만들어지고, 세션이 종료되면 영속성 컨텍스트도 없어진다.  
- **엔티티 매니저**는 이러한 일련의 과정에서 영속성 컨텍스트에 접근하기 위한 수단으로 사용된다.

  ### 엔티티 매니저 (Entity Manager)
    - 엔티티를 관리하는 객체
    - 데이터베이스에 접근해서 CRUD 작업을 수행
    - Spring Data JPA 를 사용하면 `Repository` 를사용해서 데이터베이스에 접근

      → 실제 내부 구현체인 `SimpleJpaRepository` 가 `Repository`에서 엔티티 매니저를 사용한다.

    - 엔티티 매니저는 엔티티 매니저 팩토리( EntityManagerFactory )가 만든다.
    - 엔티티 매니저 팩토리는 데이터베이스에 대응하는 객체로서 스프링 부트 에서는 자동 설정 기능이 있어 application.properties 에서 최소한의 설정만으로 동작하지만

      하이버네이트에서는 persistence.xml 이라는 설정파일을 구성하고 사용해야 한다.

    ### persistence.xml 로 설정시
    
    - 엔티티 매니저는 애플리케이션에 단 하나만 생성 되며, 모든 엔티티가 공유해서 사용한다.
    
    - 엔티티 매니저 팩토리로 생성된 엔티티 매니저는 엔티티를 영속성 컨텍스트에 추가해서 영속 객체로 만드는 작업을 수행 
    
    - 영속성 컨텍스트와 데이터베이스를 비교하면서 실제 데이터베이스를 대상으로 작업을 수행
    
    ### 엔티티의 생명주기
    
    **비영속성(New)**  
    → 영속성 컨텍스트에 추가되지 않은 엔티티 객체의 상태를 의미  
    **영속(Managed)**  
    → 영속성 컨텍스트에 의해 엔티티 객체가 관리되는 상태  
    **준영속(Detached)**  
    → 영속성 컨텍스트에 의해 관리되던 엔티티 객체가 컨텍스트와 분리된 상태  
    **삭제(Removed)**  
    → 데이터베이스에서 레코드를 삭제하기 위해 영속성 컨텍스트에 삭제요청을 한 상태